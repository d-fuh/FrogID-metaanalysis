---
title: "FrogID Meta-analysis Assignment"
output:
  html_document:
    df_print: paged
Course: BEES2041 Data Analysis for Life and Earth Sciences
Edition: 2
Date: Dec 26, 2021
---
# Preface

(1) Footnotes and references are indexed under the References and Footnotes section at the end of this notebook.

(2) [REF] refers to either of the two citations: Callaghan et al. (2020) or Cogger (2018), from which the results were analysed here. [FOT] refers to a footnote.

(3) All tables and figures used in this report are indexed in the Tables & Figures section.


# Introduction

    FrogID is a successful citizen science program led by Dr. Jodi Rowley (Australian Museum and School of Biological, Earth and Environmental Sciences, UNSW). Members of the public record frog calls on a smartphone app which are then uploaded to contribute to a large, nation-wide data base of frog species distributions (Read more at www.frogid.net.au).

    The effectiveness of citizen science programs to document flora and fauna depend on how well the public sampling represents the range of habitats and areas available. To test this, Callaghan et al. (2020) contrasted the number of frog species detected by FrogID (in each 30’ grid cells across Australia) to the number of frog species known from a data set collected by frog experts over many decades. They also considered how sampling could be affected by the remoteness of an area, and the differences among different ecoregions in Australia. See https://www.environment.gov.au/land/nrs/science/ibra/australias-ecoregions for the number and distribution of the ecoregions.


# Main

## Part A. The Questions and the Hypotheses

The questions addressed in this report are the following:

(1) Does the data on species richness of frogs in a grid cell obtained from FrogID accurately predict the known species richness from a previous, expert-derived map across Australia (Cogger, 2018)? [REF 1,2]

(2) How does the number of species (i.e. species richness) recorded by FrogID vary among ecoregions?^[FOT 1]

Note that the number of species is a measure of species richness in a grid cell recorded by both Cogger and FrogID datasets.

(3) Is the number of species recorded by FrogID affected by the remoteness of the sampling area?^[FOT 2]

The respective *null hypotheses* being tested are:

(1) $H_0$: Species richness in the previous dataset derived from Cogger, 2018 (“Cogger” hereafter) regressing on that of FrogID yields a null slope.

(2) $H_0$: The group means of species richness recorded by FrogID are not significantly different among different ecoregions defined.

(3) $H_0$: The number of species recorded by FrogID has no statistically significant relationship with the remoteness of the sampling area.


## Part B. Environment Set-up

```{r, message=FALSE}
library(tidyverse)
```

## Part C. Data Import & Clean-up

### Step 1. Download the required data files: cogger_richness_per_grid.csv, frogid_richness_per_grid.csv.

### Step 2. Read in the files:
```{r}
cogger.rpg <- read.csv(file = "cogger_richness_per_grid.csv", header = TRUE) # Long-term Cogger data ("Cogger")
frogid.rpg <- read.csv(file = "frogid_richness_per_grid.csv", header = TRUE) # Publicly sourced data ("FrogID")
```
Note: "rpg" stands for "richness per grid".

### Step 3. Data reorganisation
#### 3-1. Independent sample t-test
We want the data frame to look like:

| Species_richness ("SR") | Data set where SR was drawn from |
|-------------------------|:--------------------------------:|
| s1                      | Cogger                           |
| s2                      | FrogID                           |
| s3                      | Cogger                           |
| ...                     | ...                              |

...in order to perform the independent t-test in Part F (and to produce appropriate box plots). To do that:

```{r, warning=FALSE}
# Assigning vectors to store the data type labels (data type == "Cogger" or "FrogID")
data.type.hal <- vector(mode="character", length=2746)
data.type.frog <- vector(mode="character", length=576)

# Prepare to label each SR entry with its data file type by completing the vectors with their respective strings
for(j in 0:2745){
  data.type.hal[j+1] = "Cogger"
}

for(i in 0:575){
  data.type.frog[i+1] = "FrogID"
}

# Extract and Rename the Species Richness (SR) columns for ease of use here and later on
cogger.rpg$Species_richness_hal -> SR.hal     ## length=2746
frogid.rpg$Species_richness_frogid -> SR.frog ## length=576

# Creating two separate matrices with two columns: Species richness, and their respective Data type
t(rbind(SR.hal, data.type.hal)) -> r1
t(rbind(SR.frog, data.type.frog)) -> r2

# Renaming the rows/columns
rownames(r1) <- NULL
colnames(r1) <- c("Species_richness", "Data_from")
rownames(r2) <- NULL
colnames(r2) <- c("Species_richness", "Data_from")

# Coerce r1, r2 to data frames
as.data.frame(r1) -> r1
as.data.frame(r2) -> r2

# Check format
view(r1)
view(r2)
```

This "labels" each species richness entry with the name of the data file (Cogger/FrogID) from which they come.

We can now combine the two data frames r1, r2 using:
```{r}
bind_rows(r1, r2) -> SR.type.both  ## Stacking up the two frames r1, r2 by rows
as.numeric(SR.type.both$Species_richness) -> SR.type.both$Species_richness  ## Crucial for performing the t-test later

view(SR.type.both)  ## Check format
```

Finally, the new data frame (SR.type.both) now allows us to run an independent samples t-test on, as seen in Part F.

#### 3-2. Simple linear regression

We can make things simpler by joining the two datasets by their unique grid ID (for each recording):

```{r}
# datasets = cogger.rpg and frogid.rpg
# join by variable grid_id

mergedfrog <- merge(cogger.rpg, frogid.rpg, by = c("grid_id", "lon", "lat", "Remoteness", "aus_coastline", "Ecoregion"))
mergedfrog <- rename(mergedfrog, number_of_samples_frogid = Number_of_samples)
view(mergedfrog) ## checking format etc
```

We can then perform linear regression on the merged data set, as seen in Part F.

## Part D. Graphing and Visualisation

In the following section, we generate graphs that each address different aspects of our questions at hand.

### Question 1

> "Does the data on species richness of frogs in a grid cell obtained from FrogID accurately predict the known species richness from previous expert data sets by Dr. Cogger (2018)?"

First, we use a box plot to contrast the location and spread of the two data sets:

#### Fig. 1  Box plot: Species richness in FrogID vs Cogger
```{r}
# Before we start graphing our first plot:
theme_update(plot.title = element_text(hjust = 0.5)) ## To centralise the titles from here on for better looks

# Generate a box plot using the data frame "SR.type.both"
Figure_1 <- ggplot(SR.type.both, aes(Data_from, Species_richness)) + geom_boxplot(fill = "coral", alpha = 0.5) +
  labs(y= "Species richness", x = "Dataset") +
  ggtitle("Fig. 1  Box plot of species richness in Cogger vs. FrogID")

Figure_1
```

We see the median is slightly lower for FrogID and the spread seems larger for Cogger. There is similarity in spread and location between the two data sets, but it only provides modest evidence for an accurate prediction by FrogID data to Cogger's.


#### Fig. 2  Density plots: Species richness in FrogID vs Cogger
```{r}
# Generate an overlaying density plot from species richness in FrogID versus Cogger
Figure_2 <- ggplot(data=SR.type.both, aes(x=Species_richness, group=Data_from, fill=Data_from)) +
  geom_density(adjust=1.5, alpha=.4) +
  ggtitle("Fig. 2   Overlapping density plots for species richness in FrogID vs. Cogger")

Figure_2
```

#### Fig. 3  Bar plots: Species richness in FrogID vs. Cogger, with a) standard error bars or b) 95% confidence intervals

We first prepare a data frame in order to generate two bar plots, one with standard error bars, and one with 95% CI shown:

```{r}
# Look for t_crit for 95% CI
alpha=0.05
t=c(
  t.frog=qt((1-alpha)/2 + .5, length(SR.frog)-1), ## critical t-values for 95% CI of FrogID and Cogger species richness
  t.hal=qt((1-alpha)/2 + .5, length(SR.hal)-1)         
)
print(t) ## Checking. They shouldn't deviate from 1.96 by too much.

# Preparing the data frame, "SR.barplot", for the following bar plots
SR.barplot <- data.frame(
  Data_type=c("FrogID", "Cogger"),
  Mean=c(mean(SR.frog), mean(SR.hal)),
  Sd=c(sd(SR.frog), sd(SR.hal)),
  Se=c(sd(SR.frog)/sqrt(length(SR.frog)), sd(SR.hal)/sqrt(length(SR.hal))), #Column for standard error, se
  ic=c(t[1]*sd(SR.frog)/sqrt(length(SR.frog)), t[2]*sd(SR.hal)/sqrt(length(SR.hal))) #Column for precision
)

# Checking the format
str(SR.barplot)
```

Generating the bar plots:

```{r}
# Graphing the bar plot, with se bars (in Skyblue)
##  Notice the sample sizes differ in Cogger (N=2746) and FrogID (N=577)
Figure_3a <- ggplot(SR.barplot, aes(x = Data_type, y = Mean)) +
  geom_col(width=0.6, fill="skyblue", alpha=0.7) +
  geom_errorbar( aes(x=Data_type, ymin=Mean-Se, ymax=Mean+Se), width=0.2, colour="orange", alpha=0.9, size=1.3) +
  theme(aspect.ratio = 2/1) +
  ggtitle("Fig. 3a  Bar plot of species richness in FrogID vs. Cogger (standard error)")

Figure_3a

#Graphing the bar plot, with 95% CIs (in Forest green)
Figure_3b <- ggplot(SR.barplot, aes(x = Data_type, y = Mean)) +
  geom_col(width=0.6, fill="forestgreen", alpha=0.7) +
  geom_errorbar( aes(x=Data_type, ymin=Mean-ic, ymax=Mean+ic), width=0.2, colour="orange", alpha=0.9, size=1.3) +
  theme(aspect.ratio = 2/1) +
  ggtitle("Fig. 3b  Bar plot of species richness in FrogID vs. Cogger (95% CI)")

Figure_3b
```

#### Scatter plot: FrogID ~ Cogger

```{r, message=FALSE}
ggplot(mergedfrog, aes(x = Species_richness_frogid, y = Species_richness_hal)) + geom_point() + geom_smooth(method="lm") +
  theme_classic() +
  ggtitle("Scatter plot of FrogID species richness with Cogger data as the unique predictor")

ggsave("scatter_plot_frogID~Cogger.png", width = 10, height = 4)
```

### Question 2:

> "How does the number of species recorded by FrogID vary among ecoregions?"

There are two important things to consider first:

(1) There is one problematic datum with undefined ecoregion in row 172;

(2) The representation/distribution of ecoregions in FrogID is not uniform (e.g. lots of data for Temperate Broadleaf & Mixed Forests compared to Montane Grasslands & Shrublands, which has only 5 representations).

These issues were detected by creating a bar graph counting the number of data in each ecoregion in FrogID:

#### Fig. 4  Distribution of Ecoregions in FrogID
```{r, message=FALSE}
# Fix long names of ecoregions
frogid.rpg <- mutate(frogid.rpg, Ecoregionp = str_wrap(frogid.rpg$Ecoregion, width = 10))

    ## NB: This generates a new column storing "organised" names of ecoregions, named "Ecoregionp" (p for plotting)

# I also want to annotate the ecoregions (X) with their respective sample sizes (n): (Details in Fig. 6 chunk)
sample_size = frogid.rpg %>% group_by(Ecoregion) %>% summarize(num=n())

frogid.rpg %>%
  left_join(sample_size) %>%
  mutate(econum = paste0(Ecoregionp, "\n (n=", num, ")")) %>%

# Generate a bar graph which counts the number of data in each ecoregion in FrogID
ggplot(aes(x = econum)) +
    geom_bar() +
        # optional: scale_fill_continuous(name = "Sample size (n)", low = "colour1", high = "colour2") +
    theme_bw() +
    labs(x="Ecoregions") -> Figure_4
        # optional: + ggtitle("Fig. 4  Distribution of Ecoregions in FrogID")

Figure_4
```

Note that there are exactly 7 non-trivial types of ecoregions in FrogID. Notice also there is evident under-representation in the groups "Montane Grasslands & Shrublands" and "Tropical & Subtropical Moist Broadleaf Forests" (n=5 and n=8 respectively; mean ss=82).

To address the undefined ecoregion, we remove row 172 by:
```{r}
frogid.rpg <- slice(frogid.rpg, -172) #Removes the row with N/A ecoregion
```

We expect the removal of this data point to have little effect on the overall data behaviour for the following analyses, as it contains relatively small samples.

We can now address Question 2:

> "How does the number of species (i.e. species richness) recorded by FrogID vary among ecoregions?"

...by visualising the spread of species richness across different ecoregions. First, using box plot:

#### Fig. 5  Box plot for the number of species across ecoregions in FrogID
```{r, message=FALSE}
# Again, throw the sample size data to ggplot:
sample_size = frogid.rpg %>% group_by(Ecoregion) %>% summarize(num=n())

frogid.rpg %>%
  left_join(sample_size) %>% # For simplicity, we won't annotate the respective sample size here

# Generate a box plot representing the spread of number of species (species richness) in each ecoregion in FrogID
  ggplot(aes(x=reorder(Ecoregionp, num), y=Species_richness_frogid, fill=num)) +
                          ## Reordering ecoregions by the increasing sample size
  geom_boxplot() +
  geom_jitter(size=0.3) +
                          ## I want to reflect the sample sizes in each ecoregion corresponding to Fig. 4
                          ## here with jitters instead of labelling
  theme_bw() + scale_fill_continuous(name = "Sample size (n)", low = "darkolivegreen1", high = "darkolivegreen") +
  labs(y= "Species richness", x = "Ecoregions") -> Figure_5

  # optional: + ggtitle("Fig. 5  Box plot of the number of species across various ecoregions in FrogID")

ggsave("box_plot_nspecies_ecoregion_frogID.png", width = 7, height = 4)

Figure_5
```

From Fig. 5 we can see that:

(1) The number of species distribution appears right-skewed in most ecoregions, except "Tropical & Subtropical Moist Broadleaf Forests" and "Montane Grasslands & Shrublands" --- i.e. the regions with relatively small sample sizes. This is inferred from the asymmetry in the boxes with respect to the median line.

(2) Homoskedasticity may not be established among ecoregions in terms of species richness.

(3) We see varying species richness across ecoregions in FrogID. With highest median observed in "Tropical & Subtropical Moist Broadleaf Forests" and lowest in "Deserts & Xeric Shrublands" --- Note that this does not consider the individual sample size in each group.

These suggest that the ANOVA in Part F is likely to return a significant result, which would provide strong evidence that the number of species vary across ecoregions by the recordings of FrogID.

Additionally, we may visualise the skewness of species richness in each ecoregion directly using a violin plot:

#### Fig. 6  Violin plot of number of species across ecoregions in FrogID, with box plots embedded
```{r, message=FALSE, warning=FALSE}
# Generates a dataframe, "sample_size", that stores sample sizes for each ecoregion in FrogID:
sample_size = frogid.rpg %>% group_by(Ecoregion) %>% summarize(num=n())

# Using sample_size to annotate the upcoming plot:
frogid.rpg %>%
  
  left_join(sample_size) %>%

  mutate(econum = paste0("n=", num)) %>% ## Adding sample size of each ecoregion to the x lab

# Create the violin plot SR across ecoregions:
  ggplot(aes(x=econum, y=Species_richness_frogid, fill=Ecoregionp)) +
    geom_violin(width=5, alpha=0.9) +
    geom_boxplot(width=0.2, fill="seashell", size=0.3) + ## Embedding the box plots from Fig. 5
    theme_minimal() +
    theme(legend.title = element_text(size = 10), legend.text = element_text(size = 9)) +
    scale_fill_discrete(name = "Ecoregion") +
    labs(y= "Species richness", x = "Ecoregion") -> Figure_6
    # + ggtitle("Fig. 6  Species richness across ecoregions in FrogID, violin plot")

ggsave("violin_plot_nspecies_ecoregion_frogID.png", width = 11, height = 4)

Figure_6
```

In conclusion, **we suspect that the means of number of species indeed vary across ecoregions** from the Figures 5 & 6, with the greatest species richness seen in "Tropical & Subtropical Moist Broadleaf Forests", and the lowest species richness in "Deserts & Xeric Shrublands".


### Question 3:

> "Is the number of species recorded by FrogID (Y) affected by the remoteness (X) of the sampling area?"

We first visualise the relationship between the number of species (i.e. species richness) and remoteness in FrogID using a scatter plot:

```{r, warning=FALSE}
ggplot(frogid.rpg, aes(Remoteness, Species_richness_frogid)) + geom_point() +
  labs(y= "Number of species", x = "Remoteness") +
  ggtitle("Number of species against Remoteness in FrogID")
```

Due to the large scale of the remoteness variable, it is difficult to see if there is a direct linear relationship between the number of species and remoteness in FrogID. We need to transform the data. We suspect a log-transformation is most suitable in this scenario due to the scope of the variables.

First, we inspect the frequency histogram of both variables and that of the log-scaled variables to see the change of their location and scale under the transformation:

```{r, message=FALSE, warning=FALSE}
ggplot(frogid.rpg, aes(Remoteness)) + geom_histogram()      # Remoteness distribution in FrogID
ggplot(frogid.rpg, aes(log10(Remoteness))) + geom_histogram()  # Test if log10 shifts Remoteness to near-normal
ggplot(cogger.rpg, aes(Remoteness)) + geom_histogram()      # Is Remoteness skewed in Cogger?
```

We see that remoteness is skewed towards higher values in FrogID. This is unsurprising, as Callaghan et al. has shown that the sample size is significantly larger with less remote areas (i.e. lower remoteness), as these areas are more accessible to the public, and FrogID was a crowd-sourced project. This explains why remoteness is skewed to the right in FrogID.

We see that log(Remoteness) has a better (closer to normal) spread than the untransformed data.

We also check if the number of species ("NS") is skewed in FrogID and whether a log-transform is required for NS:
```{r, message=FALSE}
ggplot(frogid.rpg, aes(Species_richness_frogid)) + geom_histogram()         # NS distribution in FrogID
ggplot(frogid.rpg, aes(log10(Species_richness_frogid))) + geom_histogram()  # Test if log10 shifts NS to near-normal
ggplot(frogid.rpg, aes(sqrt(Species_richness_frogid))) + geom_histogram()   # Test for sqrt transform too
```

We see that the number of species is heavily skewed in FrogID. Log transformation moderately reduces the skewness by shifting some observations towards the tail. Less effect was observed under square root transform.

Since the log transformation improves the spread for remoteness optimally, and that in number of species moderately, we proceed to plot number of species against remoteness recorded by FrogID using the log transform.

#### Fig. 7  Scatter plot: Number of species against remoteness (FrogID), log-scaled for both variables

```{r, message=FALSE}
Figure_7 <- ggplot(frogid.rpg, aes(Remoteness, Species_richness_frogid)) + geom_point() +

  scale_x_log10() + scale_y_log10() + ## Scaled data are presented on the following graph *without* changing the axes metrics
  geom_smooth(method='lm') +          ## Adding a linear smoother to detect any evident linearity

  labs(y= "Number of species", x = "Remoteness") +
  ggtitle("Fig. 7  Number of species versus remoteness recorded by FrogID, log-scaled for both") +

  theme_classic()

ggsave("scatter_plot_frogID.png", width = 10, height = 4)

Figure_7
```

We first notice there is certain "stripe-ness" in the number of species versus remoteness. This is largely due to the fact that the number of species were counted data (i.e. the values recorded were strictly positive integers). This explains the discreteness seen on the Y-axis.

Overall, the linear smoother detected a negative trend in species richness over remoteness: That is, there is an association of lower species richness (i.e. less number of species found/observed) in areas with increasing remoteness. To measure the strength of this association, we will provide detailed analyses in Part F, Question 3.


## Part E. Analytical methods

### E-1.
The first question, *“Does the data on species richness of frogs in a grid cell obtained from FrogID accurately predict the known species richness from previous expert data sets by Dr. Cogger?”*, was initially approached using an **independent samples t-test**, in which we test for whether the difference between the sample mean of species richness from FrogID and that of the Cogger data is significant. This only served as a weak estimate to how close the two datasets match prior to our subsequent linear analysis.

> Test assumptions required for the independent samples t-test, namely normality and homogeneity of variance, were tested using a combination of box plots and histograms of species richness in the two data sets, the Shapiro-Wilk test for normality, Normal Q-Q plots, and the Fligner-Killeen test. The independent t-test was conducted for the species richness data in FrogID and Cogger data sets. Welch approximation was used for the independent t-test as heteroskedasticity was detected in the species richness data. The test results were summarised in Table 1.

Linear analysis: A simple linear model

    lm: FrogID species richness ~ Cogger species richness

...was performed. The merged dataset contains species richness data from both datasets joined by their unique grid ID for every matching recording (See Part C for details). The significance of this model was then measured to evaluate how well the long-term Cogger data predicts FrogID species richness from the project.

### E-2.
The second question, *“How does the number of species recorded by FrogID vary among ecoregions?”*, was analysed using the **Analysis of Variance (ANOVA)** on the log-number of species (a continuous response variable) against ecoregions (a well-defined categorical predictor) in FrogID.

> Assumptions required for ANOVA were tested using standard residual analyses, including histograms of residuals, the residuals versus fitted values ("residuals-fits") plot, and the normal Q-Q plot from the ANOVA model. An additional Fligner-Killeen test was performed to check for homogeneity of variance quantitatively. The variable *number of species* was transformed using the log base 10 function to produce appropriate data properties for ANOVA. ANOVA was conducted on log-transformed number of species by ecoregions in FrogID. The key statistics from the ANOVA model were summarised in Table 2. Tukey's HSD test was performed post hoc to specify the exact groups of ecoregions between which the means of number of species differ significantly, and was summarised in Table 3. The significant groups, and groups returning the largest differences, were further summarised in Table 4 and Table 5, respectively.

### E-3.
The third question, *“Is the number of species recorded by FrogID affected by the remoteness of the sampling area?”*, was tested using a **simple linear regression model with log-transformed variables** on the number of species by remoteness of a grid cell ("remoteness") in FrogID. The variables were transformed using the log base 10 function to improve the linear correlation and to rectify data compliance to test assumptions. Residual analyses, including inspection of histograms of residuals, residual-fits and normal Q-Q plots, were performed to confirm that the transformed data are in collaboration with assumptions for linear models. The key statistics from the linear model were summarised in Table 6. The fitted equation was presented thereafter, including its exponential (non-linear) form.


## Part F. Formal Analysis

### Question 1: Independent samples t-test + Linear regression

> Does the species richness data obtained from **FrogID** accurately predict the known species richness from previous expert datasets by Dr. **Cogger**?

#### F-1-1. Test assumptions for t-test

1. Normality of the dependent variable (species richness) in each group

Testing the normality of species richness requires their frequency histograms in the two groups:
```{r, message=FALSE}
ggplot(frogid.rpg, aes(Species_richness_frogid)) + geom_histogram()  #SR in FrogID
ggplot(cogger.rpg, aes(Species_richness_hal)) + geom_histogram()     #SR in Cogger
```

Both graphs show that the species richness is skewed in the two data sets. This violates the normality assumption, however:

    T-tests are said to be robust against the normality assumption under most circumstances.

Nevertheless, the level of departure from normality tolerable by t-tests was unspecified. We want to present other methods to assess normality in species richness for the two data sets. First, the Shapiro test:
```{r}
shapiro.test(SR.hal)  #Species richness, Cogger
shapiro.test(SR.frog) #Species richness, FrogID
```
The Shapiro-Wilk test tells us that the distribution of species richness in both datasets are (almost surely) not normal. However, it has been proposed that Shapiro-Wilks over-represents deviance from normality for large samples (See for example https://stats.stackexchange.com/questions/2492/is-normality-testing-essentially-useless). Considering the larger sample sizes of both Cogger and FrogID (N=2746 and 577 respectively), we turn to normal Q-Q plots to assess normality:

```{r}
# Normal Q-Q plot: Observe fit of the straight line for normality
qqnorm(SR.hal); qqline(SR.hal) ## Cogger
qqnorm(SR.frog); qqline(SR.frog) ## FrogID
```

Both plots suggest considerable skewness in species richness in both data sets as there is deviance from linearity in both plots. This is consistent with our observations from the histograms wherein both data are right-skewed.

We conclude that the normality assumption is violated. As a result, non-parametric tests such as the Mann-Whitney U test should be used in this scenario. This would however be beyond the scope of this report, and we carry on with the independent t-test assuming the normality assumption holds.


2. Homogeneity of Variance in two groups

This can be assessed qualitatively using the box plot and overlapping density created previously in Part D:
```{r}
Figure_1 # Box plot:  SR(Cogger) vs SR(FrogID)
Figure_2 # Overlapping density: SR(Cogger) vs SR(FrogID)
```

However, from the graphs, we can only speculate whether the variance in the two datasets are homogeneous by eyeing whether the spread within two groups differs "greatly". At first sight, the spread in two groups look a bit different.

For a more rigorous approach, we can use a variance test that is robust against non-normality and outliers such as the Fligner-Killeen test:

```{r}
fligner.test(Species_richness ~ Data_from, SR.type.both)
```
We obtained a p-value < 0.05 suggesting that the variances are significantly different in two groups (Cogger & FrogID). We consider the assumption of homogeneity of variance violated, and we proceed with the independent t-test with Welch approximation.

##### Table 1a.  Independent t-test of species richness from FrogID vs. Cogger, with Welch approximation
```{r}
# Two-tailed hypothesis
t.test(Species_richness ~ Data_from, data = SR.type.both, alternative = "two.sided", var.equal = F) -> Table_1a
Table_1a
```
The interpretation of the results is documented in Part G, Question 1.

#### F-1-2. Linear model
```{r}
# FrogID species richness ~ Cogger species richness (slm)
sr.lm <- lm(Species_richness_frogid ~ Species_richness_hal, data=mergedfrog)
Table_1b <- summary(sr.lm)
```

##### Table 1b. Linear model FrogID ~ Cogger
```{r}
Table_1b
```

### Question 2: One-way ANOVA

#### F-2-1. Restating the question:

> How does the *number of species* (**species richness**) (NS) recorded by **FrogID** vary among *ecoregions*?


#### F-2-2. Conducting an a priori test in order to check for assumptions:

```{r}
# Creates an object for the following assumption checks on the original FrogID data
Frogid.ANOVA <- aov(Species_richness_frogid ~ Ecoregion, data = frogid.rpg)
```

#### F-2-3. Test assumptions for ANOVA:

1. Normality of residuals

This is checked by the frequency histogram of residuals from the ANOVA performed:
```{r}
hist(Frogid.ANOVA$residuals)
```

We see that the residuals are not normally distributed --- we can consider the normality departured slightly in this dataset.


2. Homogeneity of variance

This is checked by the Residuals vs. Fits plot:
```{r}
plot(Frogid.ANOVA, which = c(1,2))
```

Observations:

(1) Residuals-Fits: Larger residuals are observed in groups with larger samples. Approximately, there is unequal variance within groups across ecoregions.

(2) Normal Q-Q plot: Heavy right tail => Right-skewed distribution of residuals. This is evident in the previous histogram of residuals.

Both (1) and (2) suggest that the homogeneity of variance is not strongly established --- The distribution of residuals is not uniform across ecoregions. We need to transform the data.


#### F-2-4. Data transformation:

##### 1. Using log10
```{r}
frogid.rpg <- mutate(frogid.rpg, logNS = log10(Species_richness_frogid))  # Transform NS with log10 then map to frogid.rpg
```

##### Re-verification of test assumptions under log transformation:
```{r}
#ANOVA: logNS over Ecoregion
Frogidlog.ANOVA <- aov(logNS ~ Ecoregion, data = frogid.rpg)

hist(Frogidlog.ANOVA$residuals) #Check normality of residuals
plot(Frogidlog.ANOVA, which = c(1,2)) # Check homogeneity of variance
```

Observations:

(1) Normality (of residuals) assumption is approximately met, from the modality in the histogram of residuals;

(2) Residuals-Fits plot shows that the residual distribution slightly more uniform around the fits compared to untransformed data; however, there is uneven concentration w.r.t. the fitted line^[FOT 3];

(3) Normal Q-Q plot shows light tailedness, nonetheless closer to a linear relationship than the previous.

We see that under the log10 transformation, both the normality of residuals and homogeneity of variance have improved.

##### 2. Using sqrt
```{r}
frogid.rpg <- mutate(frogid.rpg, sqNS = sqrt(Species_richness_frogid))  #sqrt(NS) -> sqNS
```

##### Verification of test assumptions, under sqrt transformation:
```{r}
#ANOVA: logNS over Ecoregion
Frogidsq.ANOVA <- aov(sqNS ~ Ecoregion, data = frogid.rpg)

hist(Frogidsq.ANOVA$residuals) #Check normality of residuals
plot(Frogidsq.ANOVA, which = c(1,2)) #Check homogeneity of variance
```

These looks very similar to the log-transformed data. However, one may say the normality is weakened under sqrt-transform and homoskedasticity improved, compared to log-transform.

We can test for homoskedasticity more rigorously using standard variance tests. First, we inspect the distribution of NS in FrogID under both transforms:
```{r, message=FALSE}
ggplot(frogid.rpg, aes(logNS)) + geom_histogram() #logNS in frogID
ggplot(frogid.rpg, aes(sqNS)) + geom_histogram() #sqNS in frogID
```

We see that both logNS and sqNS are skewed in FrogID. For minimising assumptions on normality we will use the less sensitive Fligner-Killeen test for both:
```{r}
fligner.test(logNS ~ Ecoregion, frogid.rpg) #Regardless of departure from normality in logNS and sqNS
fligner.test(sqNS ~ Ecoregion, frogid.rpg)
```
We obtained two p-values both << 0.05 which is highly significant. This suggests that variances of species richness within each ecoregion are significantly non-constant whether a log-transform or a square-root transform is used. The homogeneity of variance assumption is therefore compromised regardless of which transformation we attempt to use.

We may bypass this issue by using a non-parametric test instead of ANOVA, or find a better transformation that will transform our species richness data to normal with respect to ecoregions. However, that is beyond the scope of this report, and we carry on assuming constant variance within groups by using the log-transform.


#### F-2-5. Conducting the formal ANOVA: Using log-transformed variable, logNS

The one-way ANOVA was previously performed using log-transformed Number of Species. We can now summarise the model with:

##### Table 2.  Summary of ANOVA: logNS~Ecoregion, FrogID
```{r}
summary(Frogidlog.ANOVA) -> Table_2
Table_2
```
Detailed analyses and interpretation of the ANOVA results are in Part G.

We see the test returned a p-value approximately 0 (P < 2e-16). This supports the alternative hypothesis described in Part A. We therefore proceed with a Tukey's HSD test:

##### Table 3.  Tukey’s HSD for ANOVA: logNS~Ecoregion, FrogID
```{r}
TukeyHSD(Frogidlog.ANOVA) -> Table_3
Table_3  
```

Based on the algorithm of Tukey's HSD test, exactly ${7 \choose 2}=21$ pair-wise comparisons (of means) were made; among which, significant difference of means were detected in the following group pairs (alpha=0.05):


##### Table 4. Summary of Significant Groups from Tukey’s HSD

|Difference                | p adj        |
|--------------------------|:------------:|
|***p<<0.001***            |              |
|TG      - TB&MF           |  0.0000000   |
|T&SG    - TB&MF           |  0.0000000   |
|TB&MF   - MF              |  0.0000000   |
|TB&MF   - D&XS            |  0.0000000   |
|T&SG    - D&XS            |  0.0000000   |
|**p<0.001**               |              |
|T&SMBF  - D&XS            |  0.0000011   |
|TG      - D&XS            |  0.0004800   |
|**0.001<p<0.05**          |              |
|MF      - D&XS            |  0.0056407   |
|T&SMBF  - MF              |  0.0013882   |
|T&SMBF  - TG              |  0.0105287   |
|T&SG    - MF              |  0.0264638   |
|-----------------------------------------|
|**count**: TB&MF=4, TG=3, T&SG=3, MF=4,  |
|           D&XS=5, T&SMBF=3, MG&S=0.     |
|-----------------------------------------|
|**ns=p>0.05**             |              |
|T&SMBF-T&SG               |  0.0585673   |
|MG&S-D&XS                 |  0.0762924   |
|**ns; p>>0.05**           |              |
|T&SG-TG                   |  0.6900398   |
|MG&S-MF                   |  0.7739955   |
|T&SMBF-MG&S               |  0.7967713   |
|TG-MF                     |  0.9226158   |
|TG-MG&S                   |  0.9406842   |
|T&SMBF-TB&MF              |  0.9481627   |
|TB&MF-MG&S                |  0.9622213   |
|T&SG-MG&S                 |  0.9979508   |

where all acronyms correspond to that found in the ecoregion names in FrogID.

We notice that the groups returning significant results most frequently are:

- D&XS (5 significant comparisons)
- TB&MF and MF (4)
- TG, T&SG, and T&SMBF (3)

Specifically, only the ecoregion MG&S did not return any significant results. We suspect it has something to do with its sample size. Recall the bar plot (Fig. 4) :

```{r}
Figure_4
```
This confirms our suspicion --- it wasn't particularly the species richness in Montane Grasslands & Shrublands is not different enough from others, but that we have too little samples in MG&S (n=5) to conclude that they differ significantly from others.

In addition, the ordered pairs of ecoregions that give the largest differences in means from Tukey's test are: (listing 3)

##### Table 5. Summary of Large-difference Groups from Tukey’s HSD (Top 3)

| Ecoregions                                                                | diff       | lwr         | upr        |
| --------------------------------------------------------------------------|:----------:|:-----------:|:----------:|
| Tropical & Subtropical Moist Broadleaf Forests-Deserts & Xeric Shrublands | 0.77538661 | 0.359972868 | 1.1908004  |
| Temperate Broadleaf & Mixed Forests-Deserts & Xeric Shrubland             | 0.64102003 | 0.459138008 | 0.8229021  |
| Tropical & Subtropical Moist Broadleaf Forests-Mediterranean Forests      | 0.53401352 | 0.139042638 | 0.9289844  |

Compare Table 5 with Figure 5:
```{r}
Figure_5
```

Detailed interpretation of these results are presented in Part G, Question 2.


### Question 3: Simple linear regression

> "Is the *number of species* (NS) recorded by **FrogID** affected by the *remoteness* of the sampling area?"

#### F-3-1. A priori linear model for assumption testing:
```{r}
frogid.lm <- lm(Species_richness_frogid ~ Remoteness, data = frogid.rpg) #Linear model of NS ~ Remoteness using original data

frogid.rpg <- mutate(frogid.rpg, logR = log10(Remoteness)) #Take log10(Remoteness) to a new column "logR" in FrogID

Frogidlog.lm <- lm(logNS ~ logR, data = frogid.rpg) #Linear model using log-transformed NS and log-Remoteness

## NB: logNS was previously assigned to frogid.rpg in Part F, Q2
```

#### F-3-2. Test assumptions:

1. Linearity

In Part D, Question 3, we have shown that there is moderate level of linearity from the scatter plot logNS ~ log(Remoteness) in FrogID (Fig. 7).

2. Homogeneity of variance

We inspect the Residuals-Fits plot for the linear models using non-transformed vs log-transformed data, respectively:
```{r}
plot(frogid.lm, which = 1)    # Residuals-fits for the linear model, untransformed data
plot(Frogidlog.lm, which = 1) # Residuals-fits for the linear model, log-transformed data
```

We see that the residuals are more uniform around the fits for the log-transformed data. We conclude that the assumption of homogeneity of variance is met for the log-transformed variables.


3. Normality of residuals

We inspect the histogram of residuals as well as normal Q-Q plots of the linear models using untransformed vs log-transformed variables:
```{r}
hist(frogid.lm$residuals)    # untransformed data
hist(Frogidlog.lm$residuals) # log-transformed data
```

The histograms of residuals suggest that the distribution of residuals became near-normal under log transformation.

```{r}
plot(frogid.lm, which = 2)    # Normal Q-Q, untransformed data
plot(Frogidlog.lm, which = 2) # Normal Q-Q, log-transformed data
```

The normal Q-Q plots reflect what we have just seen in the histogram of residuals: The close match of Q-Q desired for normality of residuals is evident under log transformation, while it is heavily skewed in the original. We conclude that the normality of residuals assumption is well-met using the log-transformed data.


#### F-3-3. Summary of the linear model: Number of species ~ Remoteness in FrogID
```{r}
summary(frogid.lm)
```

The results suggest that while there is a significant linear relationship between the number of species and remoteness, the F ratio is low (F=82.57) --- We suspect that the significance was largely due to the large degrees of freedom in FrogID (df=574). We will see immediately that the linearity of their relationship is improved under the log transform.


#### F-3-4. Summary of the linear model: log(Number of species) ~ log(Remoteness) in FrogID

We've previously established in Part D, Question 3 that the untransformed number of species vs. remoteness has a rather obscure linear relationship on a scatter plot. We have also shown that linearity is improved if we transform both variables using log10. We then showed previously that the assumptions for linear models are violated if we use the untransformed data instead of log-transformed variables.

Under these premises we inspect the linear model which used the log-transformed variables:

##### Table 6.  Summary of the linear model log(NS)~log(Remoteness), FrogID
```{r}
summary(Frogidlog.lm)
```

We see that the significance is established in both models, under log transformation of both variables or not. We also see that the F-ratio has increased by about two-fold (F=166.5 compared to 82.57 in the previous model), with R-squared raised to a more meaningful level compared to the original (R-squared=0.2249 compared to 0.1258 in the previous model).


#### F-3-5. Fitted equation from lm: log(Number of species) ~ log(Remoteness) in FrogID

```{r}
format(coef(Frogidlog.lm)[1], digits = 3) -> a
format(coef(Frogidlog.lm)[2], digits = 3) -> b

print(paste("Fitted eqn: log-Number of species in Frog ID = ", a, "+ (", b, ")*log-Remoteness."))

# logNS = a + blogR
#    NS = 10^(a+blogR) = 10^a * R^(b)

format(10^coef(Frogidlog.lm)[1], digits = 3) -> A
format(coef(Frogidlog.lm)[2], digits = 3) -> B

print(paste("Non-linear eqn: Number of species in Frog ID = ", A, "*Remoteness ^", B))
```
More detailed interpretation is presented in Part G, Question 3.


## Part G. Discussion

### G-1. The first question

> “Does the data on species richness of frogs in a grid cell obtained from FrogID accurately predict the known species richness from previous expert data sets by Dr. Cogger (2018)?”

It should be first noted that we arbitrarily assumed normality of the species richness data in both data sets (FrogID & Cogger) despite significant results of departure from normality were obtained from various tests. Welch approximation was used for the independent t-test due to suspected heteroskedasticity of the species richness data. The p-value for the independent t-test was near zero (P < 2.2e-16; Table 1a), and therefore the alternative hypothesis was accepted: We conclude that there is strong evidence showing that *almost surely* the true difference for the sample means of species richness obtained from FrogID and that from the Cogger data is non-zero.

Both the overlapping density plot (Fig. 2) and the bar plots of species richness data (Fig. 3a & 3b) show significant deviation between the Cogger and FrogID species richness recording.  Callaghan et al. has shown that “there was strong evidence of FrogID species richness predicting Cogger species richness”.^[REF 1] This is supported by our linear model (P < 2.2e-16; Table 1b). Note the predictor/response variables were shuffled as we exploited the symmetry a little here.

We must note that Callaghan et al. conducted additional meta-analyses on the relative difference between FrogID and Cogger datasets whereas here, only a superficial level of "difference" between sample means were analysed using Student's t-test. In comparison, there are several caveats in our t-test approach to evaluate the accuracy of prediction by FrogID, which mainly surrounds how we should define the "accuracy of prediction" by Cogger species richness data. We propose that this particular question needs be more rigorously defined in order to build a more powerful model for its assessment.


### G-2. The Second question

> “How does the number of species recorded by FrogID vary among ecoregions?”

The near-zero p-value from ANOVA (P < 2e-16; Table 2) leads to rejection of our null hypothesis, providing very strong evidence for a significant difference in means of (log-transformed) number of species in at least two different ecoregions in FrogID.

We see from the Tukey’s HSD test that species richness varies across ecoregion almost always significantly --- The only exception being the Montane Grasslands & Shrublands group, from which insufficient samples (N=5) were drawn. Remarkably, all of the above findings are consistent with previous observation on the box plot with jitters of number of species across ecoregions in FrogID (Fig. 5). We conclude that the number of species recorded by FrogID does indeed vary among ecoregions; In particular, the mean of number of species is worth-noting-ly higher in Tropical & Subtropical Moist Broadleaf Forests, but only significantly higher in Temperate Broadleaf & Mixed Forests when sample size effect is considered; In contrast, the number of species is significantly lower in Deserts & Xeric Shrubland compared to other ecoregions (Table 4 & 5), according to the recordings of FrogID. The underlying ecological explanation for this is beyond the scope of this report.


### G-3. The Third question

> “Is the number of species recorded by FrogID affected by the remoteness of the sampling area?”

The near-zero P-values from the the linear model logNS ~ logR (P < 2e-16 for both coefficients; Table 6) suggests that there is a significant linear relationship between log-number of species and log-remoteness in FrogID. From the fitted equation we obtained the exponentiated relation:

    Number of species in Frog ID =  59.2 *Remoteness ^ -0.493

This tells us that about a 0.49% decrease in the number of species occurs for every 1% increase in remoteness in FrogID^[FOT 4]. The R-squared for the model logNS ~ logR, which uses only one predictor variable, was moderate (R2=0.2249). This suggests that there may be other lurking variables affecting the number of species recorded by FrogID other than remoteness. In conclusion, we conclude that the number of species recorded by FrogID is indeed affected by the remoteness of the sampling area negatively.




# Tables & Figures

- All plots used for verifying test assumptions (e.g. residual plots) are excluded here.
- All tables and figures can be found in the navigation tab under corresponding headings.
- The "tables" here serve as a directory to the location of test summaries completed with previous codes.
- Notation: SR=Species Richness == NS=Number of Species, (D-1) refers to Part D, Question 1, etc.

***Fig. 1***   Box plot of species richness in FrogID vs Cogger (D-1)  
***Fig. 2***   Density plots of SR(FrogID) and SR(Cogger), overlapped (D-1)  
***Fig. 3a***  Bar plot for SR in FrogID vs. Cogger, with respective standard errors (D-1)  
***Fig. 3b***  Bar plot for SR in FrogID vs. Cogger, with respective 95% confidence intervals (D-1)
***Additional figure*** Scatter plot of SR in FrogID vs Cogger, untransformed (D-1)
***Fig. 4***   Histogram of Ecoregions in FrogID (D-2)  
***Fig. 5***   Box plot of species richness across ecoregions in FrogID, with jitters (D-2)  
***Fig. 6***   Violin plot of number of species across ecoregions in FrogID, with box plots embedded (D-2)  
***Fig. 7***   Scatter plot of log-number of species vs. log-remoteness in FrogID (D-3)  


**Table 1a.** Independent t-test of species richness from FrogID vs. Cogger, with Welch approximation (F-1)  
**Table 1b.** Linear model of species richness from FrogID over Cogger, joined by grid ID (F-1)
**Table 2.** Summary of ANOVA: logNS~Ecoregion, FrogID (F-2)
**Table 3.** Tukey’s HSD for ANOVA: logNS~Ecoregion, FrogID (F-2)
**Table 4.** Summary of Significant Groups from Tukey’s HSD in Q2 (F-2)  
**Table 5.** Summary of Large-difference Groups from Tukey’s HSD in Q2 (F-2)    
**Table 6.** Summary of the linear model log(NS)~log(Remoteness), FrogID in Q3 (F-3)  



# References

1. Callaghan, C.T., Roberts, J.D., Poore, A.G.B. et al. Citizen science data accurately predicts expert-derived species richness at a continental scale when sampling thresholds are met. Biodivers Conserv 29, 1323–1337 (2020).  https://doi.org/10.1007/s10531-020-01937-3

2. Cogger, H.G. A brief demographic overview of Australia’s native amphibians. In: Heatwole H, Rowley J (eds) Status of conservation and decline of amphibians: Australia, New Zealand, and Pacific Islands. (2018). CSIRO Publishing, Clayton South.


# Footnotes

1. Definition of Ecoregions: As described by The Department of Agriculture, Water and the Environment, Government of Australia. The assignment of ecoregion in each sample was determined and described by Callaghan et al.: “Each grid cell’s centroid was also assigned to an ecoregion, relying on the WWF terrestrial ecoregions of the world map (Olson et al. 2001).”

2. “Remoteness” as defined by Callaghan et al.: “For a measure of remoteness, we used a published dataset of accessibility which encompasses spatial locations of roads, railroads, rivers, water bodies, elevation, slope angle, and land cover to produce a measure of travel time to the nearest city (Weiss et al. 2018) … We took the mean accessibility measure (in minutes) for each 30-min grid cell in the analysis, using Google Earth Engine (Gorelick et al. 2017).”

3. This reflects what we have seen previously that there are larger residuals in large-sample-sized groups. The concentration of data points above the fitted line in the res-fits plot (logNS~Ecoregion) shows that these larger residuals do not deviate uniformly from the expectation --- they are of similar values under log-transform. We suspect NS distributes sigmoidally (i.e. with saturation cap) in these groups.

4. Proof. Let NS denote the number of species in FrogID and R the remoteness. The linear model tells us that

  $NS = 59.2 * R^{-0.49}$        ---**(1)**. We only need to show w=-0.49 for the relation:

  $59.2 * [(1+1\%)R]^{-0.49} = (1+w\%) * NS$         ---**(2)**

then the statement is proved. Expanding **(2)** gives

  $59.2* 1.01^{-0.49}R^{-0.49} = (1+w\%)NS$. Using **(1)**, we have

  $59.2* 1.01^{-0.49}R^{-0.49} = (1+w\%)NS = (1+w\%) *59.2 * R^{-0.49}$. Dividing both sides by $59.2*R^{-0.49}$ (R non-0) gives

   => $(1+.01)^{-0.49} = (1+w\%)$. Since .01 < 1, we can use the linear approximation of power expansion to obtain

   => $(1+w\%) = (1+1\%)^{-0.49} \approx 1-0.49\%$  

   => $w\% \approx -0.49\%.$

which completes the proof.
